<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ELSPro Fahrzeug Configurator</title>

<style>
body{font-family:Inter,system-ui;background:#020617;color:#e5e7eb;margin:0;padding:20px}
h1{margin-bottom:10px}
.tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.tab{padding:8px 14px;border-radius:10px;background:#020617;border:1px solid #1e293b;cursor:pointer}
.tab.active{background:#2563eb}
.panel{display:none}
.panel.active{display:block}
.card{background:#020617;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 20px 50px rgba(0,0,0,.6)}
label{display:block;margin-top:10px;font-size:13px}
input,select,textarea,button{
width:100%;margin-top:6px;padding:10px;border-radius:10px;
border:1px solid #1e293b;background:#020617;color:#e5e7eb}
textarea{height:720px;font-family:ui-monospace,monospace}
.row{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
.row>*{flex:1}
button{font-weight:600;cursor:pointer}
.add{background:#22c55e;color:#022c22}
.remove{background:#dc2626}
h3{margin:0 0 6px 0}
.small{font-size:11px;opacity:.7}
</style>
</head>

<body>

<h1>ELSPro Fahrzeug Configurator</h1>

<div class="tabs">
<div class="tab active" onclick="tab(0)">Allgemein</div>
<div class="tab" onclick="tab(1)">Light</div>
<div class="tab" onclick="tab(2)">Front</div>
<div class="tab" onclick="tab(3)">Rear</div>
<div class="tab" onclick="tab(4)">Matrix</div>
<div class="tab" onclick="tab(5)">Sirenen</div>
<div class="tab" onclick="tab(6)">EnvLights</div>
</div>

<div class="card">

<!-- Allgemein -->
<div class="panel active">
<label>Spawnname<input id="vehicle" value="YourVehicle"></label>
<label>Layout<input id="layout" value="Test1"></label>
<label>NoFlash<select id="noflash"><option>true</option><option>false</option></select></label>
</div>

<!-- Light -->
<div class="panel">
<div id="light"></div>
<button class="add" onclick="addExtra(light)">+ Extra</button>
</div>

<!-- Front -->
<div class="panel">
<div id="front"></div>
<button class="add" onclick="addExtra(front)">+ Extra</button>
</div>

<!-- Rear -->
<div class="panel">
<div id="rear"></div>
<button class="add" onclick="addExtra(rear)">+ Extra</button>
</div>

<!-- MATRIX -->
<div class="panel">
<div class="card">
<h3>Matrix Modus 0</h3>
<div id="matrix0"></div>
<button class="add" onclick="addExtra(matrix0)">+ Matrix Extra</button>
</div>

<div class="card">
<h3>Matrix Modus 1</h3>
<div id="matrix1"></div>
<button class="add" onclick="addExtra(matrix1)">+ Matrix Extra</button>
</div>

<div class="card">
<h3>Matrix Modus 2</h3>
<div id="matrix2"></div>
<button class="add" onclick="addExtra(matrix2)">+ Matrix Extra</button>
</div>
</div>

<!-- Sirenen -->
<div class="panel">
<div id="sirens"></div>
<button class="add" onclick="addSiren()">+ Sirene</button>

<label>Offset (Vector3)<span class="small">z.B. vector3(0.0, 3.5, 0.5)</span></label>
<input id="sOffset" value="vector3(0.0,3.5,0.5)">
<label>Directional<select id="sdir"><option>true</option><option>false</option></select></label>
<label>Quiet Zone<select id="squiet"><option>back</option><option>front</option><option>left</option><option>right</option></select></label>
<label>Range<input id="srange" value="500.0"></label>
<label>Traffic Clear<select id="traffic"><option>true</option><option>false</option></select></label>
<label>Megaphone<select id="mega"><option>true</option><option>false</option></select></label>
</div>

<!-- ENV LIGHTS -->
<div class="panel">
<div id="env"></div>
<button class="add" onclick="addEnvGroup()">+ Env Extra</button>
</div>

<button onclick="generate()">Lua generieren</button>
<textarea id="out"></textarea>

</div>

<script>
const patterns=["tree","tree_inv","double","double_inv","rapid","single","steady","wigwag_a","wigwag_b","v47_double_A","v47_double_B","v47_double_C","matrix1","matrix2","heck_hyper","heck_rapid","heck_aggro_a","heck_aggro_b"];
const sirenList=["SIREN_ALPHA","SIREN_BRAVO","SIREN_CHARLIE","SIREN_DELTA","SIREN_ECHO","SIREN_FOXTROT","SIREN_GOLF","SIREN_HOTEL"];

function tab(i){
document.querySelectorAll('.tab').forEach((t,n)=>t.classList.toggle('active',n===i));
document.querySelectorAll('.panel').forEach((p,n)=>p.classList.toggle('active',n===i));
}

function patternSelect(){
return `<select multiple>${patterns.map(p=>`<option>${p}</option>`).join('')}</select>`;
}

function addExtra(c){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`<input class="id" placeholder="Extra ID">${patternSelect()}<button class="remove" onclick="this.parentNode.remove()">X</button>`;
c.appendChild(r);
}

function addSiren(){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`<select>${sirenList.map(s=>`<option>${s}</option>`).join('')}</select><button class="remove" onclick="this.parentNode.remove()">X</button>`;
sirens.appendChild(r);
}

/* ================= EnvLights mit vector3 ================= */
function addEnvGroup(){
const g=document.createElement('div');
g.className='card';
g.innerHTML=`
<label>Extra ID<input class="eid"></label>
<div class="elist"></div>
<button class="add">+ EnvLight</button>`;
g.querySelector('.add').onclick=()=>addEnv(g.querySelector('.elist'));
env.appendChild(g);
}

function addEnv(c){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`
<input class="type" placeholder="type" value="point">
<input class="rot" placeholder="rotation vector3" value="vector3(0.0,0.0,0.0)">
<input class="off" placeholder="offset vector3" value="vector3(1.15,1.65,2.15)">
<input class="color" type="color" value="#0000ff">
<input class="range" placeholder="range" value="25.0">
<input class="intensity" placeholder="intensity" value="2.5">
<button class="remove" onclick="this.parentNode.remove()">X</button>
`;
c.appendChild(r);
}

function parseVector3(str){
const m = str.match(/vector3\s*\(\s*([-\d.]+)\s*,\s*([-\d.]+)\s*,\s*([-\d.]+)\s*\)/i);
if(!m) return {x:0, y:0, z:0};
return {x:parseFloat(m[1]), y:parseFloat(m[2]), z:parseFloat(m[3])};
}

function buildEnvLights(){
let out=[];
[...env.children].forEach(g=>{
const eid=g.querySelector('.eid')?.value;
if(!eid) return;

const rows=[...g.querySelectorAll('.row')];
if(!rows.length) return;

let lights=rows.map(r=>{
const type = r.querySelector('input.type')?.value || "point";
const rot = parseVector3(r.querySelector('input.rot')?.value || "vector3(0,0,0)");
const off = parseVector3(r.querySelector('input.off')?.value || "vector3(0,0,0)");
const hex = r.querySelector('input.color')?.value || "#0000ff";
const range = parseFloat(r.querySelector('input.range')?.value) || 25;
const intensity = parseFloat(r.querySelector('input.intensity')?.value) || 2.5;

return `{
    type = "${type}",
    rotation = { x = ${rot.x}, y = ${rot.y}, z = ${rot.z} },
    offset = { x = ${off.x}, y = ${off.y}, z = ${off.z} },
    color = { r = ${parseInt(hex.substr(1,2),16)}, g = ${parseInt(hex.substr(3,2),16)}, b = ${parseInt(hex.substr(5,2),16)} },
    range = ${range},
    intensity = ${intensity}
}`;
});

out.push(`        [${eid}] = {\n${lights.join(',\n')}\n        },`);
});
return out.join("\n");
}

function buildExtras(c){
let o=[];
[...c.children].forEach(r=>{
const id=r.querySelector('.id')?.value;
const sel=r.querySelector('select');
if(!id||!sel)return;
const p=[...sel.selectedOptions].map(o=>`"${o.value}"`);
o.push(p.length>1?`        [${id}] = {${p.join(', ')}},`:`        [${id}] = ${p[0]},`);
});
return o.join("\n");
}

function generate(){
const sirOffset = parseVector3(sOffset.value);
out.value=
`ELSPro.Vehicles[GetHashKey("${vehicle.value}")] = {

    layout = "${layout.value}",
    noFlash = ${noflash.value},

    lightExtras = {
${buildExtras(light)}
    },

    frontExtras = {
${buildExtras(front)}
    },

    rearExtras = {
${buildExtras(rear)}
    },

    matrixExtras = {
${buildExtras(matrix0)}
    },

    matrixExtras_1 = {
${buildExtras(matrix1)}
    },

    matrixExtras_2 = {
${buildExtras(matrix2)}
    },

    wmTones = {
${[...sirens.children].map((r,i)=>`        [${i+1}] = "${r.querySelector('select').value}"`).join(',\n')}
    },

    sirenOffset = { x=${sirOffset.x}, y=${sirOffset.y}, z=${sirOffset.z} },
    sirenDirectional = ${sdir.value},
    sirenQuietZone = "${squiet.value}",
    sirenRange = ${srange.value},
    allowTrafficClear = ${traffic.value},
    hasMegaphone = ${mega.value},

    envLights = {
${buildEnvLights()}
    }
}`;
}
</script>

</body>
</html>
