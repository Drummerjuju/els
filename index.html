<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ELSPro Configurator</title>

<style>
body{font-family:Inter,system-ui;background:#020617;color:#e5e7eb;margin:0;padding:20px}
h1{margin-bottom:10px}
.tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.tab{padding:8px 14px;border-radius:10px;background:#020617;border:1px solid #1e293b;cursor:pointer}
.tab.active{background:#2563eb}
.panel{display:none}
.panel.active{display:block}
.card{background:#020617;border-radius:16px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.6)}
label{display:block;margin-top:10px;font-size:13px}
input,select,textarea,button{
width:100%;margin-top:6px;padding:10px;border-radius:10px;
border:1px solid #1e293b;background:#020617;color:#e5e7eb}
textarea{height:720px;font-family:ui-monospace,monospace}
.row{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
.row>*{flex:1}
button{font-weight:600;cursor:pointer}
.add{background:#22c55e;color:#022c22}
.remove{background:#dc2626}
</style>
</head>

<body>

<h1>ELSPro Fahrzeug Configurator</h1>

<div class="tabs">
<div class="tab active" onclick="tab(0)">Allgemein</div>
<div class="tab" onclick="tab(1)">Light</div>
<div class="tab" onclick="tab(2)">Front</div>
<div class="tab" onclick="tab(3)">Rear</div>
<div class="tab" onclick="tab(4)">Umfeld</div>
<div class="tab" onclick="tab(5)">Sirenen</div>
<div class="tab" onclick="tab(6)">EnvLights</div>
</div>

<div class="card">

<!-- ALLGEMEIN -->
<div class="panel active">
<label>Spawnname<input id="vehicle" value="yourvehicle"></label>
<label>Layout<input id="layout" value="Default"></label>
<label>NoFlash<select id="noflash"><option>true</option><option>false</option></select></label>
</div>

<!-- LIGHT / FRONT / REAR -->
<div class="panel"><div id="light"></div><button class="add" onclick="addExtra(light)">+ Extra</button></div>
<div class="panel"><div id="front"></div><button class="add" onclick="addExtra(front)">+ Extra</button></div>
<div class="panel"><div id="rear"></div><button class="add" onclick="addExtra(rear)">+ Extra</button></div>

<!-- UMFELD -->
<div class="panel">
<div id="scene"></div>
<button class="add" onclick="addScene()">+ Umfeld Extra</button>
</div>

<!-- ENVLIGHTS -->
<div class="panel">
<div id="env"></div>
<button class="add" onclick="addEnvGroup()">+ Env Extra</button>
</div>

<button onclick="generate()">Lua generieren</button>
<textarea id="out"></textarea>

</div>

<script>
const patterns=[
"double","double_inv","rapid","single","steady","wigwag_a","wigwag_b",
"v47_double_A","v47_double_B","v47_double_C",
"matrix1","matrix2","tree","tree_inv",
"heck_hyper","heck_rapid","heck_aggro_a","heck_aggro_b"
];

function tab(i){
document.querySelectorAll('.tab').forEach((t,n)=>t.classList.toggle('active',n===i));
document.querySelectorAll('.panel').forEach((p,n)=>p.classList.toggle('active',n===i));
}

function patternSelect(){
return `<select multiple>${patterns.map(p=>`<option>${p}</option>`).join('')}</select>`;
}

function addExtra(c){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`<input class="id" placeholder="Extra ID">${patternSelect()}<button class="remove" onclick="this.parentNode.remove()">X</button>`;
c.appendChild(r);
}

function addScene(){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`<input class="sid" placeholder="Extra ID"><button class="remove" onclick="this.parentNode.remove()">X</button>`;
scene.appendChild(r);
}

/* ===== ENVLIGHTS ===== */
function addEnvGroup(){
const g=document.createElement('div');
g.className='card';
g.style.marginTop='10px';
g.innerHTML=`
<label>Extra ID<input class="eid"></label>
<div class="elist"></div>
<button class="add">+ EnvLight</button>`;
g.querySelector('.add').onclick=()=>addEnv(g.querySelector('.elist'));
env.appendChild(g);
}

function addEnv(c){
const r=document.createElement('div');
r.className='row';
r.innerHTML=`
<input placeholder="type" value="point">
<input placeholder="dir" value="out">
<input placeholder="rotX" value="0.0">
<input placeholder="rotY" value="0.0">
<input placeholder="rotZ" value="0.0">
<input placeholder="offset (x,y,z)" value="1.0,1.0,1.0">
<input type="color" value="#0000ff">
<input placeholder="range" value="25.0">
<input placeholder="intensity" value="2.5">
<button class="remove" onclick="this.parentNode.remove()">X</button>`;
c.appendChild(r);
}

function vec3(str){
const v=str.split(',').map(x=>x.trim());
return `{ x=${v[0]||0}, y=${v[1]||0}, z=${v[2]||0} }`;
}

function buildExtras(c){
let o=[];
[...c.children].forEach(r=>{
const id=r.querySelector('.id').value;
const sel=r.querySelector('select');
if(!id||!sel)return;
const p=[...sel.selectedOptions].map(o=>`"${o.value}"`);
o.push(`        [${id}] = {${p.join(', ')}},`);
});
return o.join("\n");
}

function buildSceneExtras(){
let o=[];
[...scene.children].forEach(r=>{
const id=r.querySelector('.sid').value;
if(id) o.push(`        [${id}] = true,`);
});
return o.join("\n");
}

function buildEnvLights(){
let o=[];
[...env.children].forEach(g=>{
const eid=g.querySelector('.eid').value;
if(!eid)return;
const rows=[...g.querySelector('.elist').children];
let lights=rows.map(r=>{
const i=r.querySelectorAll('input');
const hex=i[6].value;
const R=parseInt(hex.substr(1,2),16);
const G=parseInt(hex.substr(3,2),16);
const B=parseInt(hex.substr(5,2),16);
return `{
                type = "${i[0].value}",
                dir = "${i[1].value}",
                rotation = { x=${i[2].value}, y=${i[3].value}, z=${i[4].value} },
                offset = ${vec3(i[5].value)},
                color = { r=${R}, g=${G}, b=${B} },
                range = ${i[7].value},
                intensity = ${i[8].value}
            }`;
});
o.push(`        [${eid}] = {\n${lights.join(',\n')}\n        },`);
});
return o.join("\n");
}

function generate(){
out.value=
`ELSPro.Vehicles[GetHashKey("${vehicle.value}")] = {

    layout = "${layout.value}",
    noFlash = ${noflash.value},

    lightExtras = {
${buildExtras(light)}
    },

    frontExtras = {
${buildExtras(front)}
    },

    rearExtras = {
${buildExtras(rear)}
    },

    sceneExtras = {
${buildSceneExtras()}
    },

    envLights = {
${buildEnvLights()}
    }
}`;
}
</script>
</body>
</html>
